@model QuizApp.Models.Quiz
<h2>@Model.Title</h2>
<p id="timer" class="mb-3 font-weight-bold">Time Remaining: 2:00</p>
<form asp-controller="Quiz" asp-action="Submit" method="post">
    <input type="hidden" name ="id" value = "@Model.Id"/>
    @for (int i =0;i<Model.Questions.Count; i++)
    {
        <p id="questionProgress" class="mb-3"></p>
        <div class="question" data-index="@i" style="display: @(i == 0 ? "block" : "none")">
            <p>
                @Model.Questions[i].Text
            </p>
            @for(int j=0;j<Model.Questions[i].Options.Count;j++)
            {
            <label>
                <input type ="radio" name="answers[@(i)]" value="@j"/>
                @Model.Questions[i].Options[j]
            </label><br/>
            }
        </div>
    }
    <div class="mt-3">
        <button type="button" id="prevBtn" class="btn btn-secondary" onclick="navigate(-1)" disabled>Previous</button>
        <button type="button" id="nextBtn" class="btn btn-primary" onclick="navigate(1)">Next</button>
        <button type="submit" id="submitBtn" class="btn btn-success" style="display:none">Submit</button>
    </div>
    <a class="btn btn-warning mt-3" asp-controller="Quiz" asp-action="Index" asp-route-id="@Model.Id"> Retake Quiz</a>
</form>

@section Scripts {
    <script>
        let currentQuestion = 0;
        const questions = document.querySelectorAll('.question');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        
        function updateProgressText() {
            const total = questions.length;
            const progressText = document.getElementById('questionProgress');
            progressText.textContent = `Question ${currentQuestion + 1} of ${total}`;
        }

        function navigate(direction) {
            // Скриваме текущия въпрос
            questions[currentQuestion].style.display = 'none';

            // Смяна на индекса
            currentQuestion += direction;

            // Граници
            if (currentQuestion <= 0) {
                currentQuestion = 0;
                prevBtn.disabled = true;
            } else {
                prevBtn.disabled = false;
            }

            if (currentQuestion >= questions.length - 1) {
                currentQuestion = questions.length - 1;
                nextBtn.style.display = 'none';
                submitBtn.style.display = 'inline-block';
            } else {
                nextBtn.style.display = 'inline-block';
                submitBtn.style.display = 'none';
            }

            // Покажи новия въпрос
            questions[currentQuestion].style.display = 'block';
            updateProgressText();
        }
        updateProgressText();
                // Set total quiz time in seconds (e.g., 10 minutes)
        let totalTime = 2 * 60;
        const timerElement = document.getElementById('timer');

        function startTimer() {
            const timerInterval = setInterval(() => {
                const minutes = Math.floor(totalTime / 60);
                const seconds = totalTime % 60;
                timerElement.textContent = `Time Remaining: ${minutes}:${seconds.toString().padStart(2,'0')}`;

                if (totalTime <= 0) {
                    clearInterval(timerInterval);
                    alert("Time's up! Submitting your quiz.");
                    document.getElementById('quizForm').submit();
                }

                totalTime--;
            }, 1000);
        }

        // Start the timer when page loads
        startTimer();
    </script>
}
